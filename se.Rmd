---
title: "Socioeconomic and Demographic Data"
author: "Jacob Ford DCHC MPO"
date: "4/5/2021"
output: html_document
---



```{r, echo=FALSE, message=FALSE, warning=FALSE, results = 'hide'}
library(dplyr)
library(ggplot2)
library(leaflet)
library(tcadr)
library(sf)
library(xlsx)
library(readxl)
library(plotly)
library(sf)
library(dplyr)
library(tidygeocoder)
library(leaflet)
library(rgdal)
library(dplyr)
library(rmarkdown)
library(crosstalk)
library(lubridate)
library(htmltools)
library(RColorBrewer)

#install.packages("kableExtra")
library(kableExtra)

triad_taz <- st_read("C:/Users/JacobFo/OneDrive - City of Durham/TRM G2/Alamance Expansion/Triad Model/Triad_TAZ.shp")

trm_taz <- st_read("C:/Users/JacobFo/OneDrive - City of Durham/TAZ_Shape.shp")

trmg2_taz <- st_read("C:/Users/JacobFo/OneDrive - City of Durham/TRM G2/Alamance Expansion/Triad Model/TRMG2_TAZ.shp")


```

**Overview**

Employment and demographic data was provided as of 2016 for the TRMG2. Existing data from both the TRMv6.2 (Orange County TAZs) and Triad Model (Alamance County TAZs) were utilized for both employment and demographic data. Convertin Triad model data into the TRMG2 was relatively simple, and below is a sample of the existing data available from the Triad Model. 

```{r, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
triad_se <- tcadr::read_tcad("C:/Users/JacobFo/OneDrive - City of Durham/TRM G2/Alamance Expansion/Triad Model/SE/SE 2017_v5_03-19-2019.bin")

triad_se_df <- triad_se[triad_se$COUNTY_NAME=="Alamance",]




triad_se_df %>%
  select(ID ,COUNTY_NAME,  HH, POP_GRP_QT, POP_IN_HH, EMP_HWYRET, EMP_IND, EMP_RETAIL, EMP_SERVICE, EMP_OFFICE,SCHOOL_EMP, K12_STUDENT)

triad_se_df <- head(triad_se_df, 10)


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
kbl(triad_se_df, caption="Triad Socioeconomic and Demographic Data (sample)") %>%
  kable_classic(html_font="Cambria")
```

**Employment Data**

Employment data for TAZs in Alamance County is sourced from the Triad Model, whereas TAZs in Orange County used existing TRMv6.2 employment data. Where splits occurred from either the Triad or TRMv6.2, a distribution factor was applied. InfoUSA 2016 point data formed the distribution factor. The point layer is available below. Employment categories were split based off the proportion of the points within the new TRMG2 TAZ boundaries. 



```{r, echo=FALSE, message=FALSE, warning=FALSE, results = 'hide'}

orange_emp <-st_read("C:/Users/JacobFo/OneDrive - City of Durham/TRM G2/Alamance Expansion/SE Data/Employment/Mebane_OC_Employment_2016.shp")
alamance_emp <- st_read("C:/Users/JacobFo/OneDrive - City of Durham/TRM G2/Alamance Expansion/SE Data/Employment/Mebane_AC_Employment_2016.shp")

```



The below map shows the point layer over the TRMG2 TAZ boundaries: 


```{r, echo=FALSE, message=FALSE, warning=FALSE}

map <- leaflet(data=triad_taz) %>%
  setView(-79.26, 36.05, zoom=11) %>%
  addProviderTiles(providers$CartoDB.Positron)%>%
  addPolygons(data=triad_taz,
              group="Triad",
              color="red",
              fillColor = "lightgrey",
              weight=2,
             # fill=NA,
              dashArray = c("5,10"),
              popup=paste("Triad TAZ ID: ", triad_taz$TAZ)) %>%
    addPolygons(data=trm_taz,
              group="TRM",
              color="black",
              fillColor="blue",
              weight=1,
              popup=paste("TRM TAZ ID: ", trm_taz$TAZ_ID)) %>%
  addPolygons(data=trmg2_taz,
              group="TRMG2",
              color="green",
              weight=1,
              popup=paste("TRMG2 TAZ ID: ", trmg2_taz$TAZ_ID)) %>%
    addCircles(data=orange_emp,
             radius=orange_emp$EMP_2016RE,
              group="Orange Employment",
              popup=paste("Company Name: ", orange_emp$COMPANY_NA, "<br>",
                          "TRM Employment Category: ", orange_emp$ESTAB_TYP2,"<br>",
                          "Employees: ", orange_emp$EMP_2016RE)) %>%
  addCircles(data=alamance_emp,
             radius=alamance_emp$ACTUAL_LOC,
             fillColor ="green",
             group="Alamance Employment",
             popup=paste("Company Name: ", alamance_emp$COMPANY_NA, "<br>",
                         "TRM Employment Category: ", alamance_emp$TRM_EMPLOY, "<br>",
                         "Employees: ", alamance_emp$ACTUAL_LOC)) %>%
  addLayersControl(overlayGroups = c("Triad", "TRM", "TRMG2", "Alamance Employment", "Orange Employment"))

map %>% hideGroup("Triad") %>% hideGroup("TRM")
```

**Demographic Data**

Where the employment data was distributed using InfoUSA point data, parcel data exported as centroids available from the respective county website were used as the distributive factor for number of households and population. To filter out commericial or non-residential homes, the parcel classification from county websites was used. Pin numbers are used at the home level to join parcel point data and parcel polygon layers from the county website, however only the final point layer is provided below. Home type classifications is available below when clicking on a point:  

```{r, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}


orange_parcel <- st_read("C:/Users/JacobFo/OneDrive - City of Durham/Orange_Parcel_Points_v2.shp")

alamance_parcel <- st_read("C:/Users/JacobFo/OneDrive - City of Durham/Alamance_Parcel_Points.shp")
```


```{r}
parcel_map <-leaflet(data=alamance_parcel)%>%
  setView(-79.26, 36.05, zoom=11) %>%
  addProviderTiles(providers$CartoDB.Positron)%>%
  addCircles(data=alamance_parcel,
            group ="Alamance Parcels",
             radius=alamance_parcel$AHBED_,
             color="green",
            popup=paste("Home Type: ", alamance_parcel$XXDDC1, "<br>")) %>%
  addCircles(data=orange_parcel,
            group="Orange Parcels", radius=2,
          color="orange",
          popup=paste("Home Type: ", orange_parcel$LBSCDESC)) %>%
    addPolygons(data=triad_taz,
              group="Triad",
              color="red",
              fillColor = "lightgrey",
              weight=2,
             # fill=NA,
              dashArray = c("5,10"),
              popup=paste("Triad TAZ ID: ", triad_taz$TAZ)) %>%
    addPolygons(data=trm_taz,
              group="TRM",
              color="black",
              fillColor="blue",
              weight=1,
              popup=paste("TRM TAZ ID: ", trm_taz$TAZ_ID)) %>%
  addPolygons(data=trmg2_taz,
              group="TRMG2",
              color="green",
              weight=1,
              popup=paste("TRMG2 TAZ ID: ", trmg2_taz$TAZ_ID)) %>%
  addLayersControl(overlayGroups = c("Triad", "TRM", "TRMG2", "Alamance Parcels", "Orange Parcels"))

parcel_map %>% hideGroup("TRM") %>% hideGroup("Triad")
```

